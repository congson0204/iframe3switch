<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3-Gang Switch IFrame</title>
<style>
  :root{
    --bg:#f5f7fb; --plate:#ffffff; --stroke:#d5d9e2;
    --text:#0f172a; --muted:#64748b;
    --on:#22c55e; --off:#94a3b8;
    --ind-on:#3b82f6; --ind-off:#cbd5e1;
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;}
  .wrap{height:100%;display:grid;place-items:center;padding:8px;}
  .panel{
    width:min(92vw,420px); aspect-ratio:1/1; background:var(--plate);
    border-radius:14px; box-shadow:0 6px 22px rgba(2,6,23,.12);
    display:grid; grid-template-columns:repeat(3,1fr); overflow:hidden;
    border:1px solid var(--stroke);
  }
  .key{
    position:relative; display:grid; grid-template-rows:1fr auto 16px; align-items:end;
    border-left:1px solid var(--stroke);
    transition:background 0.2s;
  }
  .key:first-child{border-left:none;}
  .btn{
    margin:14px; border-radius:10px; border:1px solid var(--stroke);
    background:linear-gradient(#ffffff,#f3f6fb);
    box-shadow: inset 0 1px 0 #fff, 0 2px 6px rgba(15,23,42,.08);
    cursor:pointer; outline:none; transition:all .15s ease;
    height:90%;
  }
  .btn:active{transform:scale(0.98);}
  .label{
    text-align:center; font-size:14px; color:var(--muted); margin-bottom:8px;
    letter-spacing:.3px; user-select:none;
  }
  .dot{
    height:4px; width:24px; border-radius:999px; margin:0 auto 12px;
    background:var(--ind-off); transition:background-color .18s ease;
  }
  /* ON state visuals */
  .key.on .btn{background:linear-gradient(#d9ffe7,#afffcb); border-color:#b7efc5;}
  .key.on .label{color:var(--on); font-weight:600;}
  .key.on .dot{background:var(--ind-on);}
  .btn:focus-visible{box-shadow:0 0 0 3px rgba(59,130,246,.35);}
  .head{
    position:absolute; top:8px; right:12px; color:#94a3b8; font-size:11px; letter-spacing:.2px;
  }
</style>
</head>
<body>
  
<div class="wrap">
  <div class="panel" id="panel">
    <div class="head">
      <span id="deviceId">device-unknown</span>
    </div>

    <div class="key" id="sw1">
      <button class="btn" id="btn-sw1">1</button>
      <div class="label" id="status-sw1">OFF</div>
      <div class="dot"></div>
    </div>

    <div class="key" id="sw2">
      <button class="btn" id="btn-sw2">2</button>
      <div class="label" id="status-sw2">OFF</div>
      <div class="dot"></div>
    </div>

    <div class="key" id="sw3">
      <button class="btn" id="btn-sw3">3</button>
      <div class="label" id="status-sw3">OFF</div>
      <div class="dot"></div>
    </div>
  </div>
</div>
<script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
<script>
  const switches = ["sw1", "sw2", "sw3"];
  const state = { sw1:false, sw2:false, sw3:false };

  function render(id){
    const key = document.getElementById(id);
    const status = document.getElementById(`status-${id}`);
    const on = state[id];
    key.classList.toggle("on", on);
    status.textContent = on ? "ON" : "OFF";
  }

  function toggle(id){
    state[id] = !state[id];
    render(id);
    window.parent?.postMessage({type:"era:command", id, value:state[id]}, "*");
  }

  switches.forEach(id=>{
    document.getElementById(`btn-${id}`).addEventListener("click", ()=>toggle(id));
    render(id);
  });

  window.addEventListener("message",(event)=>{
    const msg = event.data||{};
    if(msg.type==="era:update" && switches.includes(msg.id)){
      state[msg.id]=!!msg.value; render(msg.id);
    }
    if(msg.type==="era:batch" && msg.data){
      switches.forEach(k=>{if(k in msg.data){state[k]=!!msg.data[k];render(k);}});
      if(msg.deviceId) document.getElementById("deviceId").textContent=msg.deviceId;
    }
  });

const btn-sw1 = document.getElementById('btn-sw1'); 
let configLed = null, newStatusLed = null, actions = []; 
const eraWidget = new EraWidget();
    eraWidget.init({
            needRealtimeConfigs: true,         /* Cần giá trị hiện thời */
            needHistoryConfigs: true,          /* Cần giá trị lịch sử */
            needActions: true,                 /* Cần các hành động (ví dụ Bật/Tắt đèn) */
            maxRealtimeConfigsCount: 3,        /* Số lượng tối đa giá trị hiện thời */
            maxHistoryConfigsCount: 1,         /* Số lượng tối đa giá trị lịch sử */
            maxActionsCount: 2,                /* Số lượng tối đa các hành động có thể kích hoạt */
            minRealtimeConfigsCount: 0,        /* Số lượng tối thiểu giá trị hiện thời */
            minHistoryConfigsCount: 0,         /* Số lượng tối thiểu giá trị lịch sử */
            minActionsCount: 0,                /* Số lượng tối thiểu hành động */

            /* Hàm callback được gọi khi có cấu hình được nhận từ server */
            onConfiguration: (configuration) => {
                /* Cập nhật cấu hình đèn LED từ cấu hình thời gian thực đầu tiên */
                configLed = configuration.realtime_configs[0];
                actions = configuration.actions; /* Lưu danh sách các hành động được nhận */
            },

            /* Hàm callback được gọi khi nhận giá trị mới từ server */
            onValues: (values) => {
                /* Lấy trạng thái hiện tại của đèn LED từ giá trị của cấu hình */
                const stateLed = values[configLed.id].value;

                /* Kiểm tra nếu trạng thái đèn thay đổi */
                if (newStatusLed !== stateLed) {
                    newStatusLed = stateLed;      /* Cập nhật trạng thái mới của đèn */
                   updateSwitch(stateLed); /* Thay đổi trạng thái của switch dựa trên trạng thái đèn */
                }
            },
        });
function updateSwitch(state) {
  const key = document.getElementById("sw1");
  const label = document.getElementById("status-sw1");

  if(state === 1){
    key.classList.add("on");
    label.textContent = "ON";
  } else {
    key.classList.remove("on");
    label.textContent = "OFF";
  }
}




</script>



  

  
</body>
</html>

